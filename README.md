## üìù ToDo

- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ (socat, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã)
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª Modbus RTU
- [x] –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–º–∞–Ω–¥ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Ö–æ–¥—è—â–∏—Ö –∫–æ–º–∞–Ω–¥ 
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã CRC 
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π UI –Ω–∞ tkinter –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞ —à–ª–∞–≥–±–∞—É–º–∞
- [x] –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–º–∞–Ω–¥—ã –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ 
- [x] –°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π http —Å–µ—Ä–≤–µ—Ä (REST API) 
- [x] –î–æ–±–∞–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö sqlite, –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ç—É–¥–∞ –∏—Å—Ç–æ—Ä–∏—é 
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (api_key) –Ω–∞ —Ä–æ—É—Ç—ã (open/close) 
- [x] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫(–¥—Ä–∞–π–≤–µ—Ä) –¥–ª—è RFID
- [x] –°–¥–µ–ª–∞—Ç—å —ç–º—É–ª—è—Ç–æ—Ä —Å—á–∏—Ç—ã–≤–∞—Ç–µ–ª—è RFID –∫–∞—Ä—Ç

## üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ COM-–ø–æ—Ä—Ç—ã)

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —ç–º—É–ª—è—Ü–∏—é —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–µ–∂–¥—É **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º (Master)** –∏ **–®–ª–∞–≥–±–∞—É–º–æ–º (Slave)**.

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ç–∏–ª–∏—Ç—ã
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `socat` - —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö:

```bash
brew install socat
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
socat -d -d pty,raw,echo=0 pty,raw,echo=0&
socat -d -d pty,raw,echo=0 pty,raw,echo=0&
```

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è –¥–≤–∞ –∞–¥—Ä–µ—Å–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—é.
–ü—Ä–∏–º–µ—Ä:
```bash
[1] 60987 // –ø–µ—Ä–≤–∞—è –ø–∞—Ä–∞ (Modbus)
[2] 60988 // –≤—Ç–æ—Ä–∞—è –ø–∞—Ä–∞ (RFID)
2025/12/23 20:35:39 socat[60987] N PTY is /dev/ttys006 // Controller Modbus
2025/12/23 20:35:39 socat[60988] N PTY is /dev/ttys007 // Controller RFID
2025/12/23 20:35:39 socat[60987] N PTY is /dev/ttys008 // –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞ (Modbus) —à–ª–∞–∫–±–∞—É–º–∞
2025/12/23 20:35:39 socat[60988] N PTY is /dev/ttys009 // –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞ RFID –∫–∞—Ä—Ç—ã
```

> **–í–∞–∂–Ω–æ:** –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –æ–∫–Ω–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ —Å –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π `socat`, –∏–Ω–∞—á–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å.

## üì° –ü—Ä–æ—Ç–æ–∫–æ–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É **Modbus RTU**.

*   **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (Master):** –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –∏ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
*   **–®–ª–∞–≥–±–∞—É–º (Slave):** –°–ª—É—à–∞–µ—Ç –ª–∏–Ω–∏—é, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å.

–û–±–º–µ–Ω –ø–∞–∫–µ—Ç–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ COM-–ø–æ—Ä—Ç—ã.

## üì§ üì• HTTP —Å–µ—Ä–≤–µ—Ä

API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–æ—Ç–∫—Ä—ã—Ç–æ/–∑–∞–∫—Ä—ã—Ç–æ) –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞.


–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

```bash
GET http://localhost:8081/status
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "device_id": 1,
  "status": "open",
  "timestamp": 1765208622
}
```

#### –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π

| –ü–æ–ª–µ        | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                                 |
|--------------|----------|------------------------------------------|
| `device_id`  | number  | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞      |
| `status`     | string  | –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (`open` –∏–ª–∏ `close`)   |
| `timestamp`  | number  | –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ Unix timestamp (—Å–µ–∫—É–Ω–¥—ã) |

---

–û—Ç–∫—Ä—ã–≤–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
POST http://localhost:8081/open
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "ok": true,
  "timestamp": 1765208644
}
```

#### –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π

| –ü–æ–ª–µ        | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                                 |
|--------------|----------|------------------------------------------|
| `ok`         | boolean | –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏                     |
| `timestamp`  | number  | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ (Unix time)   |

---

–ó–∞–∫—Ä—ã–≤–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
POST http://localhost:8081/close
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "ok": true,
  "timestamp": 1765208667
}
```

---

–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
GET http://localhost:8081/history
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
[    {
        "created_at": "2025-12-09 23:18:59",
        "device_id": 0,
        "id": 2,
        "message": "–®–ª–∞–≥–±–∞—É–º –∑–∞–∫—Ä—ã—Ç",
        "type": "INFO"
    },
    {
        "created_at": "2025-12-09 23:18:41",
        "device_id": 0,
        "id": 1,
        "message": "–®–ª–∞–≥–±–∞—É–º –æ—Ç–∫—Ä—ã—Ç",
        "type": "INFO"
    }
]
```

---

### **–ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤**

| –ö–æ–¥ | –ó–Ω–∞—á–µ–Ω–∏–µ              | –û–ø–∏—Å–∞–Ω–∏–µ                         |
|------|-----------------------|----------------------------------|
| 200  | OK                    | –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ          |
| 400  | Bad Request           | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å              |
| 500  | Internal Server Error | –û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞        |

---

### **–ü—Ä–∏–º–µ—Ä—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º cURL**

#### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å

```bash
curl -X GET http://localhost:8081/status
```

#### –û—Ç–∫—Ä—ã—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

```bash
curl -X POST http://localhost:8081/open
```

#### –ó–∞–∫—Ä—ã—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

```bash
curl -X POST http://localhost:8081/close
```

